(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["197"],{"1233":function(e,t,n){"use strict";n.d(t,"t",function(){return r});n.d(t,"e",function(){return i});n.d(t,"n",function(){return s});var r,i,s;(function(e){e[e.WebhookSubscription=0]="WebhookSubscription";e[e.Meta=1]="Meta";e[e.EventHub=2]="EventHub"})(r||(r={}));(function(e){e[e.DriveStatusChange=0]="DriveStatusChange";e[e.QuotaAllowanceChange=1]="QuotaAllowanceChange";e[e.QuotaStateChange=2]="QuotaStateChange";e[e.Zip=3]="Zip";e[e.ProfileChange=4]="ProfileChange"})(i||(i={}));(function(e){e[e.PushChannelProvider=0]="PushChannelProvider";e[e.ItemAutoRefreshProvider=1]="ItemAutoRefreshProvider";e[e.ItemAutoRefreshDataSource=2]="ItemAutoRefreshDataSource"})(s||(s={}))},"1604":function(e,t,n){"use strict";n.d(t,"e",function(){return r});var r;(function(e){e[e.Add=0]="Add";e[e.Update=1]="Update";e[e.Remove=2]="Remove"})(r||(r={}))},"2464":function(e,t,n){"use strict";n.r(t);n.d(t,"resourceKey",function(){return v});var r=n(0),i=n(1604),s=n(7),o=n(5),u=n(4),a=n(123),f=n(109),l=n(1233),c=n(1460),h=n(388),p=n(15),d=(function(e){Object(r.__extends)(t,e);function t(t,n){var r=e.call(this,t,n)||this;r._itemsStore=n.itemsStore;r._urlDataSource=n.urlDataSource;r._vaultDataSource=n.vaultDataSource;r._pushChannelProvider=n.pushChannelProvider;r._updateQuota=n.updateQuota;r._isOneDriveWinApp=Object(a.e)();return r}t.prototype.isEnabled=function(){return Object(u.isFeatureEnabled)(u.EnablePushChannelAutoRefresh)};t.prototype.isAuthValid=function(){return!0};t.prototype.onGetChanges=function(e){};t.prototype.createSubscription=function(e,t,n){};t.prototype.onSubscriptionCreated=function(){};t.prototype.deleteSubscription=function(e){};t.prototype.getChangesHeaders=function(){var e;if(this._isOneDriveWinApp&&this._vaultDataSource.isVaultOpen().peek())return(e={}).Prefer="Include-Feature=Vault",e};t.prototype.parseChangesResponse=function(e){for(var t=[],n=!1,r=0,i=e.value;r<i.length;r++){var s=i[r];s.vault&&(n=!0);"!0"===s.id.substring(s.id.length-2)&&(s.id=this._urlDataSource.getDefaultRootItemId());var o=null;s.parentReference&&(o=s.parentReference.id)&&"!0"===o.substring(o.length-2)&&(o=this._urlDataSource.getDefaultRootItemId());o||this._pushChannelProvider.log(l.n.ItemAutoRefreshDataSource,"Invalid parent resource id for item",s);var u=null;if(s.eTag&&"function"==typeof atob)try{u=atob(s.eTag.substr(1))}catch(e){this._pushChannelProvider.log(l.n.ItemAutoRefreshDataSource,"Failed to decode eTag for item",s)}t.push({deleted:!!s.deleted,id:s.id,eTag:u,parentId:o,dateModified:s.lastModifiedDateTime})}n&&this._updateQuota(n);return t};t.prototype.onMessage=function(e){var t,n,r=[],s=this._urlDataSource.getDefaultRootItemId();e.sort(function(e,t){return e.parentId===s?1:t.parentId===s?-1:0});for(var o=0;o<e.length;o++){var u=e[o];this._pushChannelProvider.log(l.n.ItemAutoRefreshDataSource,"onMessage",u);var a=this._urlDataSource.getKey(((t={}).id=u.id,t)),f=this._itemsStore.getItem(a);if(f){var c=f();this._pushChannelProvider.log(l.n.ItemAutoRefreshDataSource,"Changed Item",c);if(c.eTag===u.eTag||u.deleted&&""===c.eTag)for(var h=o+1;h<e.length;h++){if(e[h].id===u.parentId){this._pushChannelProvider.log(l.n.ItemAutoRefreshDataSource,"Removing parent to prevent a refresh");e.splice(h,1);break}}else u.deleted?r.push({type:i.e.Remove,parentKey:c.parentKey,item:c}):r.push({type:i.e.Update,parentKey:c.parentKey,item:c})}else if(u.parentId){a=this._urlDataSource.getKey(((n={}).id=u.parentId,n));r.push({type:i.e.Add,parentKey:a})}}return r};t.dependencies=Object(r.__assign)(Object(r.__assign)({},s.e.dependencies),{itemsStore:f.e,urlDataSource:p.be,vaultDataSource:p.Se,pushChannelProvider:c.e,updateQuota:h.e});return t})(s.e);t.default=d;var v=Object(o.s)("ItemAutoRefreshDataSource",d)}}]);